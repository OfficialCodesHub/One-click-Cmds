#!/usr/bin/env bash
export LC_ALL=C.UTF-8
export LANG=C.UTF-8

set -u

# ---- COLORS ----
C=$'\033[36m'
G=$'\033[32m'
R=$'\033[31m'
B=$'\033[34m'
Y=$'\033[33m'
W=$'\033[97m'
P=$'\033[35m'
BLINK=$'\033[5m'
N=$'\033[0m'

# ---- TYPEWRITER EFFECT ----
typewriter() {
    text="$1"
    delay=0.005
    for ((i=0; i<${#text}; i++)); do
        printf "%s" "${text:$i:1}"
        sleep $delay
    done
    printf "\n"
}

# ---- PROGRESS BAR ----
progress_bar() {
    echo -e "${C}Initializing AYUSHTHEWARRIOR NODE...${N}"
    for i in {1..30}; do
        printf "${G}#${N}"
        sleep 0.03
    done
    echo ""
    for i in {0..100..10}; do
        printf "\r${Y}Loading System: $i%%%${N}"
        sleep 0.15
    done
    echo ""
    sleep 1
}

# ---- INTRO ----
intro() {
    clear
    echo -e "${P}"
    typewriter " â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— "
    typewriter "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ "
    typewriter "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ "
    typewriter "â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘ "
    typewriter "â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ "
    typewriter "â•šâ•â•  â•šâ•â•   â•šâ•â•    â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• "
    echo -e "${N}"
    echo ""
    typewriter "ðŸ’Ž AYUSHTHEWARRIOR NODE BOOTING..."
    sleep 1
    progress_bar
    clear
}

# ---- HEADER ----
header() {
    echo -e "${P}${BLINK}ðŸ’Ž AYUSHTHEWARRIOR NODE ðŸ’Ž${N}"
    echo -e "${Y}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${N}"
    echo ""
}

pause() {
    echo ""
    read -p "${W}Press [Enter] to return...${N}" dummy
}

# ---- PTERODACTYL MENU FUNCTION ----
ptero_menu() {
    while true; do
        clear
        echo "========================================="
        echo "   PTERODACTYL CONTROL CENTER v2.1"
        echo "========================================="
        echo ""
        echo "1) Install Panel"
        echo "2) Install Wings"
        echo "3) Create User"
        echo "4) Update Panel"
        echo "5) Install SSL"
        echo "6) Uninstall Panel"
        echo "7) Back to Main Menu"
        echo ""
        read -p "Select option: " opt

        case $opt in
            1)
                bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/install.sh)
                read -p "Press Enter..."
                ;;
            2)
                bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/wings)
                read -p "Press Enter..."
                ;;
            3)
                cd /var/www/pterodactyl 2>/dev/null && php artisan p:user:make
                read -p "Press Enter..."
                ;;
            4)
                cd /var/www/pterodactyl || { echo "Panel not installed!"; sleep 2; continue; }
                php artisan down
                curl -Lo panel.tar.gz https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz
                tar -xzvf panel.tar.gz
                COMPOSER_ALLOW_SUPERUSER=1 composer install --no-dev --optimize-autoloader
                php artisan migrate --seed --force
                php artisan up
                read -p "Press Enter..."
                ;;
            5)
                bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/ssl.sh)
                read -p "Press Enter..."
                ;;
            6)
                rm -rf /var/www/pterodactyl
                echo "Panel Removed."
                sleep 2
                ;;
            7)
                break
                ;;
            *)
                echo "Invalid option"
                sleep 1
                ;;
        esac
    done
}

# ---- START ----
intro

# ---- MAIN LOOP ----
while true; do
    clear
    header

    echo -e "${C} 1) ${W}Discord Server Link${N}"
    echo -e "${C} 2) ${W}Proxmox VE (Docker) Install ðŸš€${N}"
    echo -e "${C} 3) ${W}VM/KVM Installer${N}"
    echo -e "${C} 4) ${W}Pterodactyl Panel Installer${N}"
    echo -e "${C} 5) ${W}ALL MINECRAFT Panel Installer${N}"
    echo -e "${C} 6) ${W}Blueprint + Addon Installer${N}"
    echo -e "${C} 7) ${W}Lxd Installer${N}"
    echo -e "${C} 8) ${W}SFTP Fixer${N}"
    echo -e "${C} 9) ${W}Tailscale VPN Installer${N}"
    echo -e "${R} 10) Exit${N}"

    echo ""
    read -p "${Y}Select an option [1-9]: ${N}" choice

    case $choice in
        1)
            echo -e "${G}https://discord.gg/kypp9pXYpN${N}"
            pause
            ;;
        2)
            docker run -itd \
              --name proxmoxve \
              --hostname pve \
              --privileged \
              --cgroupns=host \
              --security-opt apparmor=unconfined \
              --security-opt seccomp=unconfined \
              -v /sys/fs/cgroup:/sys/fs/cgroup:rw \
              -v /lib/modules:/lib/modules:ro \
              -v /dev/fuse:/dev/fuse \
              -v /sys/kernel/debug:/sys/kernel/debug \
              -p 8006:8006 \
              --restart unless-stopped \
              rtedpro/proxmox:9.0.11
            pause
            ;;
        3)
            echo ""
            echo -e "${Y}ðŸ’» Creating VM (Work in Any VPS)...${N}"
            bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/003)
            pause
            ;;
        4)
            ptero_menu
            ;;
        5)
            echo ""
            echo -e "${Y}ðŸ–¥ï¸  ALL MINECRAFT PANEL${N}"
            bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/panels/refs/heads/main/panelsop)
            pause
            ;;
        6)
            echo ""
            echo -e "${Y}ðŸ–¥ï¸  Installing Blueprint + Addon${N}"
            bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/Blueprint%20%2B%20Addon%20Installer)
            pause
            ;;
        7)
            echo ""
            echo -e "${Y}ðŸ–¥ï¸  Lxd Installer${N}"
            bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/lxd%20installer)
            pause
            ;;
        8)
            echo ""
            echo -e "${Y}ðŸ–¥ï¸  Fixing SFTP...${N}"
            bash <(curl -fsSL https://raw.githubusercontent.com/OfficialCodesHub/One-click-Cmds/refs/heads/main/ssh.sh)
            pause
            ;;
        9)
            curl -fsSL https://tailscale.com/install.sh | sh
            pause
            ;;
        10)
            echo -e "${G}AYUSHTHEWARRIOR NODE ROCKS ðŸ˜ŽðŸ”¥${N}"
            sleep 1
            exit 0
            ;;
        *)
            echo -e "${R}Invalid Option!${N}"
            sleep 1.5
            ;;
    esac
done
